apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__6"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__7"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__1"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__2"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__3"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__4"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__5"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__6"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__7"="beløb")))
#set af date
apotek.2$date2 <- as.Date(as.yearqtr(apotek.2$date, format = "%q-%Y"))
#In the dataset from the farmacy there is 2 products with the packsize of 1 that is listed in g instead of mg,
#so they are changed to 1000 (since they are both 1g)
apotek.2 <- within(apotek.2, styrke[Lægemiddelnavn == "Sendoxan" & packsize == 1] <- 1000)
apotek.2 <- within(apotek.2, styrke[Lægemiddelnavn == "Holoxan" & packsize == 1] <- 1000)
View(apotek.2)
prisprmg<- read_dta("K:/FORSK-Projekt/Projekter/Scientific Projects/175_relapsprojekt_sundhedsøkonomi/6. Conferences/NorPM2018/stata/07_relaps_prispermg_dispform.dta")
apotek <- read_excel("K:/FORSK-Projekt/Projekter/Scientific Projects/175_relapsprojekt_sundhedsøkonomi/6. Conferences/NorPM2018/stata/Forbrugsudtræk for haematologisk afdeling for 2016-2017 22-02-2018_rettet 08-03-2018.xlsx",
range = "A4:W102")
#Removal of en empty price
apotek.1<-apotek[!(apotek$Lægemiddelnavn=="Dexamethason" & apotek$Dispenseringsform=="injektionsvæske"),]
#Renaming the columns
names(apotek.1)[names(apotek.1)=="ATC-kode og beskrivelse niveau 5"] <- "ATC-kode"
names(apotek.1)[names(apotek.1)=="Styrke numerisk"] <- "styrke"
names(apotek.1)[names(apotek.1)== "Pakningstørrelse numerisk (Apovision)"] <- "packsize"
#removing redundant
apotek.1$`Pakningsstørrelse beskrivelse (Apovision)` <- NULL
apotek.1$`Styrke beskrivelse (Apovision)` <- NULL
#Removing the product name from ATC-codes
apotek.1$`ATC-kode` <- gsub("\\ .*","",apotek.1$`ATC-kode`)
#Dispenseform - I create a new binary varible that is 0=non-inj, 1=inj
apotek.1$dispform <- 1
apotek.1$dispform[apotek.1$Dispenseringsform=="tabletter"]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="filmovertrukne tabl."]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="kapsler, bløde"]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="kapsler, hårde"]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="overtrukne tabletter"]<-0
apotek.1$Dispenseringsform <- NULL
apotek.1 <- as.data.frame(apotek.1)
apotek.2 <- melt(apotek.1, id=c("ATC-kode","dispform","Lægemiddelnavn","packsize","styrke"))
#add time
apotek.2$date <- 1
apotek.2$date[apotek.2$variable=="Antal pakninger"] <- "01-2016"
apotek.2$date[apotek.2$variable=="Beløb"] <- "01-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__1"] <- "02-2016"
apotek.2$date[apotek.2$variable=="Beløb__1"] <- "02-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__2"] <- "03-2016"
apotek.2$date[apotek.2$variable=="Beløb__2"] <- "03-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__3"] <- "04-2016"
apotek.2$date[apotek.2$variable=="Beløb__3"] <- "04-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__4"] <- "01-2017"
apotek.2$date[apotek.2$variable=="Beløb__4"] <- "01-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__5"] <- "02-2017"
apotek.2$date[apotek.2$variable=="Beløb__5"] <- "02-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__6"] <- "03-2017"
apotek.2$date[apotek.2$variable=="Beløb__6"] <- "03-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__7"] <- "04-2017"
apotek.2$date[apotek.2$variable=="Beløb__7"] <- "04-2017"
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__1"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__2"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__3"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__4"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__5"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__6"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__7"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__1"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__2"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__3"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__4"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__5"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__6"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__7"="beløb")))
#set af date
apotek.2$date2 <- as.Date(as.yearqtr(apotek.2$date, format = "%q-%Y"))
#In the dataset from the farmacy there is 2 products with the packsize of 1 that is listed in g instead of mg,
#so they are changed to 1000 (since they are both 1g)
apotek.2 <- within(apotek.2, styrke[Lægemiddelnavn == "Sendoxan" & packsize == 1] <- 1000)
apotek.2 <- within(apotek.2, styrke[Lægemiddelnavn == "Holoxan" & packsize == 1] <- 1000)
apotek.2.1 <- subset(apotek.2, variable==beløb)
apotek.2.1 <- subset(apotek.2, variable=="beløb")
library(ggplot2)
ggplot(apotek.2.1, aes(x=date2, y=beløb, color=ATC.kode)) + geom_line()
ggplot(apotek.2.1, aes(x=date2, y=value, color=ATC.kode)) + geom_line()
apotek.2$mgtotal <- apotek.2$styrke * apotek.2$packsize
prisprmg<- read_dta("K:/FORSK-Projekt/Projekter/Scientific Projects/175_relapsprojekt_sundhedsøkonomi/6. Conferences/NorPM2018/stata/07_relaps_prispermg_dispform.dta")
apotek <- read_excel("K:/FORSK-Projekt/Projekter/Scientific Projects/175_relapsprojekt_sundhedsøkonomi/6. Conferences/NorPM2018/stata/Forbrugsudtræk for haematologisk afdeling for 2016-2017 22-02-2018_rettet 08-03-2018.xlsx",
range = "A4:W102")
#Removal of en empty price
apotek.1<-apotek[!(apotek$Lægemiddelnavn=="Dexamethason" & apotek$Dispenseringsform=="injektionsvæske"),]
#Renaming the columns
names(apotek.1)[names(apotek.1)=="ATC-kode og beskrivelse niveau 5"] <- "ATC"
names(apotek.1)[names(apotek.1)=="Styrke numerisk"] <- "styrke"
names(apotek.1)[names(apotek.1)== "Pakningstørrelse numerisk (Apovision)"] <- "packsize"
#removing redundant
apotek.1$`Pakningsstørrelse beskrivelse (Apovision)` <- NULL
apotek.1$`Styrke beskrivelse (Apovision)` <- NULL
#Removing the product name from ATC-codes
apotek.1$`ATC` <- gsub("\\ .*","",apotek.1$`ATC`)
#Dispenseform - I create a new binary varible that is 0=non-inj, 1=inj
apotek.1$dispform <- 1
apotek.1$dispform[apotek.1$Dispenseringsform=="tabletter"]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="filmovertrukne tabl."]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="kapsler, bløde"]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="kapsler, hårde"]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="overtrukne tabletter"]<-0
apotek.1$Dispenseringsform <- NULL
apotek.1 <- as.data.frame(apotek.1)
apotek.2 <- melt(apotek.1, id=c("ATC-kode","dispform","Lægemiddelnavn","packsize","styrke"))
#add time
apotek.2$date <- 1
apotek.2$date[apotek.2$variable=="Antal pakninger"] <- "01-2016"
apotek.2$date[apotek.2$variable=="Beløb"] <- "01-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__1"] <- "02-2016"
apotek.2$date[apotek.2$variable=="Beløb__1"] <- "02-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__2"] <- "03-2016"
apotek.2$date[apotek.2$variable=="Beløb__2"] <- "03-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__3"] <- "04-2016"
apotek.2$date[apotek.2$variable=="Beløb__3"] <- "04-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__4"] <- "01-2017"
apotek.2$date[apotek.2$variable=="Beløb__4"] <- "01-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__5"] <- "02-2017"
apotek.2$date[apotek.2$variable=="Beløb__5"] <- "02-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__6"] <- "03-2017"
apotek.2$date[apotek.2$variable=="Beløb__6"] <- "03-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__7"] <- "04-2017"
apotek.2$date[apotek.2$variable=="Beløb__7"] <- "04-2017"
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__1"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__2"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__3"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__4"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__5"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__6"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__7"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__1"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__2"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__3"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__4"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__5"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__6"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__7"="beløb")))
#set af date
apotek.2$date2 <- as.Date(as.yearqtr(apotek.2$date, format = "%q-%Y"))
#In the dataset from the farmacy there is 2 products with the packsize of 1 that is listed in g instead of mg,
#so they are changed to 1000 (since they are both 1g)
apotek.2 <- within(apotek.2, styrke[Lægemiddelnavn == "Sendoxan" & packsize == 1] <- 1000)
apotek.2 <- within(apotek.2, styrke[Lægemiddelnavn == "Holoxan" & packsize == 1] <- 1000)
apotek.1 <- as.data.frame(apotek.1)
apotek.2 <- melt(apotek.1, id=c("ATC","dispform","Lægemiddelnavn","packsize","styrke"))
#add time
apotek.2$date <- 1
apotek.2$date[apotek.2$variable=="Antal pakninger"] <- "01-2016"
apotek.2$date[apotek.2$variable=="Beløb"] <- "01-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__1"] <- "02-2016"
apotek.2$date[apotek.2$variable=="Beløb__1"] <- "02-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__2"] <- "03-2016"
apotek.2$date[apotek.2$variable=="Beløb__2"] <- "03-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__3"] <- "04-2016"
apotek.2$date[apotek.2$variable=="Beløb__3"] <- "04-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__4"] <- "01-2017"
apotek.2$date[apotek.2$variable=="Beløb__4"] <- "01-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__5"] <- "02-2017"
apotek.2$date[apotek.2$variable=="Beløb__5"] <- "02-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__6"] <- "03-2017"
apotek.2$date[apotek.2$variable=="Beløb__6"] <- "03-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__7"] <- "04-2017"
apotek.2$date[apotek.2$variable=="Beløb__7"] <- "04-2017"
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__1"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__2"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__3"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__4"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__5"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__6"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__7"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__1"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__2"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__3"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__4"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__5"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__6"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__7"="beløb")))
#set af date
apotek.2$date2 <- as.Date(as.yearqtr(apotek.2$date, format = "%q-%Y"))
#In the dataset from the farmacy there is 2 products with the packsize of 1 that is listed in g instead of mg,
#so they are changed to 1000 (since they are both 1g)
apotek.2 <- within(apotek.2, styrke[Lægemiddelnavn == "Sendoxan" & packsize == 1] <- 1000)
apotek.2 <- within(apotek.2, styrke[Lægemiddelnavn == "Holoxan" & packsize == 1] <- 1000)
View(apotek.2)
apotek.3 <- dcast(apotek.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + value + date + date2 ~ variable)
apotek.3 <- cast(apotek.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + value + date + date2 ~ variable)
View(apotek.3)
apotek.3 <- cast(apotek.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + value + date + date2 ~ variable, value.var="value")
apotek.3 <- cast(apotek.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + date + date2 ~ variable, value.var="value")
install.packages("reshape2")
library(reshape2)
apotek.3 <- dcast(apotek.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + date + date2 ~ variable, value.var="value")
View(apotek.3)
apotek.3 <- dcast(apotek.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + date + date2 ~ variable, value.var="value")
apotek.3 <- dcast(apotek.2, ATC + dispform + Lægemiddelnavn + packsize + value + styrke + date + date2 ~ variable, value.var="value")
apotek.2.2 <- apotek.2[1:6,]
View(apotek.2.2)
apotek.3 <- dcast(apotek.2.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + date + date2 ~ variable, value.var="value")
apotek.3 <- dcast(apotek.2.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + date + date2 ~ value, value.var="variable")
apotek.3 <- dcast(apotek.2.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + date + date2 ~ variable, value.var="value")
apotek.3 <- dcast(apotek.2.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + date + date2 ~ variable, value.var="value", fun.aggregate = sum)
apotek.3 <- dcast(apotek.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + date + date2 ~ variable, value.var="value", fun.aggregate = sum)
apotek.3$mgtotal <- apotek.2$styrke * apotek.2$packsize
apotek.3$mgtotal <- apotek.3$styrke * apotek.3$packsize
apotek.3$mgpakke <- apotek.3$styrke * apotek.3$packsize
apotek.3$mgtotal <- apotek.3$antal * apotek.3$mgpakke
apotek.3$price1mg <- apotek.3$beløb/apotek.3$mgtotal
apotek.4 <-aggregate(apotek.3, by=list(Lægemiddelnavn), FUN=mean, na.rm=TRUE)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$Lægemiddelnavn), FUN=mean, na.rm=TRUE)
View(apotek.4)
warnings()
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC), FUN=mean, na.rm=TRUE)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), FUN=mean, na.rm=TRUE)
apotek.4$diff <- apotek.4$price1mg - prisprmg$ppmg_w_rowmean
5/4*100
apotek.4$diff <- ((apotek.4$price1mg - prisprmg$ppmg_w_rowmean)/prisprmg$ppmg_w_rowmean)*100
format(apotek.4$diff, scientific = FALSE)
apotek.4 <- format(apotek.4$diff, scientific = FALSE)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), FUN=mean, na.rm=TRUE)
apotek.4$diff <- ((apotek.4$price1mg - prisprmg$ppmg_w_rowmean)/prisprmg$ppmg_w_rowmean)*100
apotek.4$diff <- format(apotek.4$diff, scientific = FALSE)
test <- merge(apotek.4, prisprmg, by=c("Group.1","atc"))
test <- merge(apotek.4, prisprmg, by=c(Group.1,atc))
test <- merge(apotek.4, prisprmg, by=c("Group.1","atc"))
prisprmg$atc <- as.char(prisprmg$atc)
prisprmg$atc <- as.character(prisprmg$atc)
test <- merge(apotek.4, prisprmg, by=c("Group.1","atc"))
View(prisprmg)
test <- merge(x=apotek.4,y=prisprmg,by.x = c("Group.1"),by.y = c("atc"),all.y = TRUE)
View(test)
test$diff <- ((test$price1mg - test$ppmg_w_rowmean)/test$ppmg_w_rowmean)*100
test$diff <- format(test$diff, scientific = FALSE)
library(haven)
library(readxl)
library(reshape)
library(plyr)
library(zoo)
library(reshape2)
prisprmg<- read_dta("K:/FORSK-Projekt/Projekter/Scientific Projects/175_relapsprojekt_sundhedsøkonomi/6. Conferences/NorPM2018/stata/07_relaps_prispermg_dispform.dta")
apotek <- read_excel("K:/FORSK-Projekt/Projekter/Scientific Projects/175_relapsprojekt_sundhedsøkonomi/6. Conferences/NorPM2018/stata/Forbrugsudtræk for haematologisk afdeling for 2016-2017 22-02-2018_rettet 08-03-2018.xlsx",
range = "A4:W102")
#Removal of en empty price
apotek.1<-apotek[!(apotek$Lægemiddelnavn=="Dexamethason" & apotek$Dispenseringsform=="injektionsvæske"),]
#Renaming the columns
names(apotek.1)[names(apotek.1)=="ATC-kode og beskrivelse niveau 5"] <- "ATC"
names(apotek.1)[names(apotek.1)=="Styrke numerisk"] <- "styrke"
names(apotek.1)[names(apotek.1)== "Pakningstørrelse numerisk (Apovision)"] <- "packsize"
#removing redundant
apotek.1$`Pakningsstørrelse beskrivelse (Apovision)` <- NULL
apotek.1$`Styrke beskrivelse (Apovision)` <- NULL
#Removing the product name from ATC-codes
apotek.1$`ATC` <- gsub("\\ .*","",apotek.1$`ATC`)
#Dispenseform - I create a new binary varible that is 0=non-inj, 1=inj
apotek.1$dispform <- 1
apotek.1$dispform[apotek.1$Dispenseringsform=="tabletter"]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="filmovertrukne tabl."]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="kapsler, bløde"]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="kapsler, hårde"]<-0
apotek.1$dispform[apotek.1$Dispenseringsform=="overtrukne tabletter"]<-0
apotek.1$Dispenseringsform <- NULL
apotek.1 <- as.data.frame(apotek.1)
apotek.2 <- melt(apotek.1, id=c("ATC","dispform","Lægemiddelnavn","packsize","styrke"))
#add time
apotek.2$date <- 1
apotek.2$date[apotek.2$variable=="Antal pakninger"] <- "01-2016"
apotek.2$date[apotek.2$variable=="Beløb"] <- "01-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__1"] <- "02-2016"
apotek.2$date[apotek.2$variable=="Beløb__1"] <- "02-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__2"] <- "03-2016"
apotek.2$date[apotek.2$variable=="Beløb__2"] <- "03-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__3"] <- "04-2016"
apotek.2$date[apotek.2$variable=="Beløb__3"] <- "04-2016"
apotek.2$date[apotek.2$variable=="Antal pakninger__4"] <- "01-2017"
apotek.2$date[apotek.2$variable=="Beløb__4"] <- "01-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__5"] <- "02-2017"
apotek.2$date[apotek.2$variable=="Beløb__5"] <- "02-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__6"] <- "03-2017"
apotek.2$date[apotek.2$variable=="Beløb__6"] <- "03-2017"
apotek.2$date[apotek.2$variable=="Antal pakninger__7"] <- "04-2017"
apotek.2$date[apotek.2$variable=="Beløb__7"] <- "04-2017"
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__1"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__2"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__3"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__4"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__5"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__6"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Antal pakninger__7"="antal")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__1"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__2"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__3"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__4"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__5"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__6"="beløb")))
apotek.2 <- transform(apotek.2, variable=revalue(variable,c("Beløb__7"="beløb")))
#set af date
apotek.2$date2 <- as.Date(as.yearqtr(apotek.2$date, format = "%q-%Y"))
#In the dataset from the farmacy there is 2 products with the packsize of 1 that is listed in g instead of mg,
#so they are changed to 1000 (since they are both 1g)
apotek.2 <- within(apotek.2, styrke[Lægemiddelnavn == "Sendoxan" & packsize == 1] <- 1000)
apotek.2 <- within(apotek.2, styrke[Lægemiddelnavn == "Holoxan" & packsize == 1] <- 1000)
#now i seperate beløb and antal again with dcast.. impportent.. this aggregates some prices of products with similar spec except for unit-dose vs. blister
apotek.3 <- dcast(apotek.2, ATC + dispform + Lægemiddelnavn + packsize + styrke + date + date2 ~ variable, value.var="value", fun.aggregate = sum)
apotek.3$mgpakke <- apotek.3$styrke * apotek.3$packsize
apotek.3$mgtotal <- apotek.3$antal * apotek.3$mgpakke
apotek.3$price1mg <- apotek.3$beløb/apotek.3$mgtotal
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), FUN=mean, na.rm=TRUE)
#Check the difference between new averages and Henriks averages
prisprmg$atc <- as.character(prisprmg$atc)
test <- merge(apotek.4, prisprmg, by=c("Group.1","atc"))
test <- merge(x=apotek.4,y=prisprmg,by.x = c("Group.1"),by.y = c("atc"),all.y = TRUE)
test$diff <- ((test$price1mg - test$ppmg_w_rowmean)/test$ppmg_w_rowmean)*100
test$diff <- format(test$diff, scientific = FALSE)
#Plot with gg
#apotek.2.1 <- subset(apotek.2, variable=="beløb")
#ggplot(apotek.2.1, aes(x=date2, y=value, color=ATC.kode)) + geom_line()
View(apotek.4)
View(apotek.3)
apotek.test <- subset(apotek.3, ATC==L01BC01)
apotek.test <- subset(apotek.3, ATC=="L01BC01")
View(apotek.test)
sum(apotek.test$antal)
sum(apotek.test$antal, na.rm=T)
sum(apotek.test$beløb, na.rm=T)
sum(apotek.test$mgtotal, na.rm=T)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), FUN=mean, na.rm=TRUE)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), "sum", na.rm=TRUE)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), FUN=mean, na.rm=TRUE)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
apotek.3.1 <- apotek.3[2,]
View(apotek.3.1)
apotek.3.1 <- apotek.3[-c(6,7),]
apotek.3.1 <- apotek.3[,-c(6,7)]
apotek.4 <-aggregate(apotek.3.1, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), FUN=mean, na.rm=TRUE)
View(prisprmg)
View(apotek)
View(apotek.3)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), FUN=mean, na.rm=TRUE)
apotek.4 <-aggregate(apotek.3, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
View(test)
apotek.4 <-aggregate(apotek.3$beløb, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
View(apotek.4)
apotek.5 <-aggregate(apotek.3$mgtotal, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
View(apotek.5)
apotek.4$x/apotek.5$x
apotek.4 <-aggregate(apotek.3$beløb * apotek.3$mgtotal, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
apotek.5 <-aggregate(apotek.3$mgtotal, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
apotek.4$x/apotek.5$x
apotek.5 <-aggregate(apotek.3$mgtotal, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
apotek3$mmx <- paste0(apotek.3$ATC, apotek.3$dispform)
apotek.3$mmx <- paste0(apotek.3$ATC, apotek.3$dispform)
apotek.3$mmx <- paste(apotek.3$ATC, apotek.3$dispform, sep = ".")
apotek.5 <-aggregate(apotek.3$mgtotal, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
apotek.5$mmx <- paste(apotek.5$Group.1, apotek.5$Group.2, sep = ".")
apotek.3 <- merge(apotek.3, apotek.5, by = "mmx", all.x = T)
apotek.4 <-aggregate((apotek.3$beløb * apotek.3$mgtotal) / apotek.3$x, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
apotek.5 <-aggregate(apotek.3$mgtotal, by=list(apotek.3$ATC, apotek.3$dispform), FUN=sum, na.rm=TRUE)
View(apotek.1)
devtools::install_github("HaemAalborg/EQvalue")
library(EQvalue)
score <- c(11111,23242,53212)
name <- c("Hansen","Jensen","Olesen")
df <- data.frame(score,name)
QALY(df, country="dk", name="score")
QALY(df, country="dk", name="score")
library(EQvalue)
QALY(df, country="dk", name="score")
devtools::install_github("HaemAalborg/EQvalue")
devtools::install_github("HaemAalborg/EQvalue")
library(EQvalue)
score <- c(11111,23242,53212)
name <- c("Hansen","Jensen","Olesen")
df <- data.frame(score,name)
QALY(df, country="dk", name="score")
library(EQvalue)
library(EQvalue)
score <- c(11111,23242,53212)
name <- c("Hansen","Jensen","Olesen")
df <- data.frame(score,name)
QALY(df, country="dk", name="score")
library(plyr)
score <- c(11111,23242,53212)
name <- c("Hansen","Jensen","Olesen")
df <- data.frame(score,name)
QALY(df, country="dk", name="score")
library(EQvalue)
install_github("HaemAalborg/EQvalue")
library(devtools)
install_github("HaemAalborg/EQvalue")
force=T
library(EQvalue)
install_github("HaemAalborg/EQvalue")
install_github("HaemAalborg/EQvalue", force = TRUE)
library(EQvalue)
install_github("HaemAalborg/EQvalue", force = TRUE)
library(plyr)
library(EQvalue)
score <- c(11111,23242,53212)
name <- c("Hansen","Jensen","Olesen")
df <- data.frame(score,name)
QALY(df, country="zb", name="score")
QALY(df, country="dk", name="score")
EQpaste(df)
install_github("HaemAalborg/EQvalue", force = TRUE)
library(devtools)
install_github("HaemAalborg/EQvalue", force = TRUE)
library("EQvalue", lib.loc="~/R/win-library/3.4")
EQpaste(df)
library(EQvalue)
score <- c(11111,23242,53212)
name <- c("Hansen","Jensen","Olesen")
df <- data.frame(score,name)
QALY(df, country="dk", name="score")
EQpaste(df)
QALY(df, country="dk", name="score")
library(plyr)
QALY(df, country="dk", name="score")
EQpaste(df)
EQpaste <- function(x) {
x$STATE <- paste(x$MOBILITY, x$SELFCARE, x$ACTIVITY, x$PAIN, x$ANXIETY, sep="")
return(x)
}
EQpaste(df)
detach("package:EQvalue", unload=TRUE)
install_github("HaemAalborg/EQvalue", force = TRUE)
library(EQvalue)
install.packages("C:/Users/upc6/Documents/GitHub/EQvalue", repos = NULL, type="source")
library(EQvalue)
QALY(df, country="us", name="score")
View(QALY)
score <- c(11111,23242,53212)
name <- c("Hansen","Jensen","Olesen")
df <- data.frame(score,name)
QALY(df, country="us", name="score")
QALY(df, country="dk", name="score")
install.packages("C:/Users/upc6/Documents/GitHub/EQvalue", repos = NULL, type="source")
detach("package:EQvalue", unload=TRUE)
library(EQvalue)
QALY(df, country="dk", name="score")
View(QALY)
QALY(df, country="us", name="score")
detach("package:EQvalue", unload=TRUE)
install.packages("C:/Users/upc6/Documents/GitHub/EQvalue", repos = NULL, type="source")
library(EQvalue)
score <- c(11111,23242,53212)
name <- c("Hansen","Jensen","Olesen")
df <- data.frame(score,name)
QALY(df, country="us", name="score")
QALY(df, country="dk", name="score")
load("C:/Users/upc6/Documents/GitHub/EQvalue/inst/extdata/values.RData")
View(EQ5D5L_values_5L)
detach("package:EQvalue", unload=TRUE)
install.packages("C:/Users/upc6/Documents/GitHub/EQvalue", repos = NULL, type="source")
library(EQvalue)
QALY(df, country="dk", name="score")
QALY(df, country="us", name="score")
QALY(df, country="jp", name="score")
install_github("HaemAalborg/EQvalue", force = TRUE)
library(devtools)
install_github("HaemAalborg/EQvalue", force = TRUE)
library(EQvalue)
QALY(df, country="nl", name="score")
install.packages("bannerCommenter")
library(bannerCommenter)
#run the following command which saves the comment to clipboard
#then just paste on next line of script
banner("Section 1:", "Data input and initialization", emph = TRUE)
#run the following command which saves the comment to clipboard
#then just paste on next line of script
banner("Section 1:", "Data input and initialization", emph = F)
#run the following command which saves the comment to clipboard
#then just paste on next line of script
banner("Section 1:", "Data input and initialization")
QALY(df, country="nl", name="score")
QALY(df, country="dk", name="score")
QALY(df, country="us", name="score")
#run the following command which saves the comment to clipboard
#then just paste on next line of script
banner("Section 1:", "HADS Scores")
#run the following command which saves the comment to clipboard
#then just paste on next line of script
banner("Section 1:", "QLQ-C30  Scores")
#run the following command which saves the comment to clipboard
#then just paste on next line of script
banner("Section 3:", "EQ-5D-5L  Scores")
#run the following command which saves the comment to clipboard
#then just paste on next line of script
banner("Title:", "Script to calculate scores from 3 life quality questionaires", emph = T)
#run the following command which saves the comment to clipboard
#then just paste on next line of script
banner("section:1", "Data Management", emph = F)
#run the following command which saves the comment to clipboard
#then just paste on next line of script
banner("section 5:", "Output", emph = F)
library(devtools)
setwd("~/GitHub/cencost")
devtools::document()
devtools::document()
